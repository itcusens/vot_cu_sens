<div class="container">
  <div class="title">Simulare vot cu SENS</div>

  <div class="form-container">
    <div class="top-config" [ngClass]="showConfig ? 'open' : ''" (click)="toggleConfig()">
      <label>Setari simulare</label>
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white" class="bi bi-caret-down" viewBox="0 0 16 16">
        <path d="M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659"/>
      </svg>
    </div>
    <div class="config" [ngClass]="showConfig ? '' : 'hidden'">
      <div class="top-container">
        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>NumƒÉr candida»õi</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="numCandidates"
            (ngModelChange)="onCandidateCountChange()"
            placeholder="e.g. 5"
          />
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>NumƒÉr membri CN</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="numWinners"
            placeholder="e.g. 2"
          />
        </mat-form-field>

        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>NumƒÉr votan»õi</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="numVoters"
            placeholder="e.g. 10"
          />
        </mat-form-field>
      </div>
      <div class="candidate-table" *ngIf="candidateNames.length">
        <h3>Nume candidati</h3>
        <table class="preview-table">
          <tr *ngFor="let name of candidateNames; let i = index; trackBy: trackByIndex">
            <td>#{{ i + 1 }}</td>
            <td class="candidates-column">
              <input
                [ngModel]="candidateNames[i]"
                (ngModelChange)="onCandidateNameChange(i, $event)"
                placeholder="AdaugƒÉ nume"
                style="width: 97%; padding: 6px;"
              />
            </td>
          </tr>
        </table>
      </div>

      <div class="bottom-container">
        <div>
          <mat-checkbox [(ngModel)]="useRandomBallots">
            GenereazƒÉ buletine de vot aleatorii
          </mat-checkbox>
        </div>

        <div class="csv-upload">
          <label for="csvFile">Upload Ballot CSV:</label>
          <p>Se poate incarca un document .csv cu buletinele de vot pentru simulare</p>
          <label class="custom-file-upload">
            <input type="file" id="csvFile" accept=".csv" (change)="onCsvUpload($event)">
            Choose file
          </label>
        </div>

        <div class="buttons-container">
          <button mat-raised-button color="warn" (click)="resetAll()">Reset</button>
          <button mat-raised-button color="primary" (click)="simulate()">Simulate</button>
        </div>
      </div>
    </div>
  </div>


  <div *ngIf="simulationResults.length > 0" class="carousel-container">
    <h3 style="color: #8bc34a;">Simulation Rounds</h3>

    <div class="buttons-container">
      <button mat-raised-button (click)="goToPrevRound()" [disabled]="currentRound === 0">Previous</button>
      <button mat-raised-button (click)="goToNextRound()" [disabled]="currentRound === simulationResults.length - 1">Next</button>
    </div>

    <div class="round-results">
      <h4 style="color: white;">Round {{ currentRound + 1 }}</h4>

      <table class="results-table">
        <thead>
          <tr>
            <th>Candidate</th>
            <th>1st Choice Votes</th>
            <th>Borda Score</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let candidate of getSortedCandidatesForRound(currentRound)">
            <td>{{ candidate.name }}</td>
            <td>{{ candidate.firsts }}</td>
            <td>{{ candidate.borda }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="winners.length > 0" class="winner-container">
      <h3 class="winner-title">Final Results / Winners</h3>
      <ul>
        <li *ngFor="let winner of winners" class="winner-item">
          üèÜ {{ winner }}
        </li>
      </ul>
    </div>
  </div>

  <div *ngIf="!useRandomBallots" class="manual-ballots">
    <h3 style="color: #8bc34a;">Enter Ballots</h3>

    <div class="ballot-navigation">
      <button mat-raised-button (click)="prevBallot()" [disabled]="currentBallotIndex === 0">Previous Ballot</button>

      <span>Ballot {{ currentBallotIndex + 1 }} of {{ numVoters }}</span>

      <button mat-raised-button (click)="nextBallot()" [disabled]="currentBallotIndex >= numVoters - 1">Next Ballot</button>

      <div style="margin-top: 10px;">
        <label>Jump to Ballot: </label>
        <input
          type="number"
          min="1"
          [max]="numVoters"
          [(ngModel)]="ballotJumpInput"
          placeholder="Ballot #"
          style="width: 80px;"
        />
        <button mat-raised-button (click)="jumpToBallot()">Go</button>
      </div>
    </div>

    <div class="ballot-grid-container">
      <app-vote
        [allNames]="candidateNames"
        [maxRows]="candidateNames.length"
        [showPreview]="false"
        [showRandomize]="true"
        [ballot]="manualBallots[currentBallotIndex] || []"
        (ballotChange)="onBallotChange(currentBallotIndex, $event)"
      ></app-vote>
    </div>
  </div>


</div>
